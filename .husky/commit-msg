#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ“ éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼..."

# å¦‚æœæœ¬åœ°å·²å®‰è£… commitlintï¼Œåˆ™è¿è¡Œä¸¥æ ¼æ ¡éªŒï¼›å¦åˆ™è·³è¿‡ä½†ç»™å‡ºæç¤º
if node -e "require.resolve('@commitlint/cli')" >/dev/null 2>&1; then
  npx --no-install commitlint --edit "$1" || {
    echo "âŒ commitlint æ ¡éªŒå¤±è´¥ï¼Œè¯·æŒ‰çº¦å®šå¼æäº¤ä¿®å¤æäº¤ä¿¡æ¯"
    exit 1
  }
else
  echo "â„¹ï¸  æœªæ£€æµ‹åˆ° @commitlint/cliï¼Œè·³è¿‡ä¸¥æ ¼æ ¡éªŒï¼ˆCI ä¼šå†æ¬¡æ£€æŸ¥ï¼‰"
fi

commit_msg=$(cat "$1")

# åŸºæœ¬é•¿åº¦æ£€æŸ¥ï¼ˆå…œåº•ï¼‰
if [ ${#commit_msg} -lt 10 ]; then
  echo "âš ï¸ æäº¤ä¿¡æ¯è¿‡çŸ­ï¼Œè‡³å°‘éœ€è¦ 10 ä¸ªå­—ç¬¦"
  echo "ğŸ’¡ ç¤ºä¾‹: feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
  exit 1
fi

# ç®€å•å‰ç¼€æ£€æŸ¥ï¼ˆè¾…åŠ©æé†’ï¼‰
if echo "$commit_msg" | grep -qE "^(WIP|wip|fix|feat|docs|style|refactor|test|chore|perf|build|ci|revert)"; then
  echo "âœ… æäº¤ä¿¡æ¯æ ¼å¼åŸºæœ¬é€šè¿‡"
else
  echo "âš ï¸ å»ºè®®ä½¿ç”¨çº¦å®šå¼æäº¤æ ¼å¼ï¼š"
  echo "   feat: æ–°åŠŸèƒ½"
  echo "   fix: ä¿®å¤ bug"
  echo "   docs: æ–‡æ¡£"
  echo "   style: ä»£ç é£æ ¼"
  echo "   refactor: é‡æ„"
  echo "   test: æµ‹è¯•"
  echo "   chore: æ„å»º/å·¥å…·"
  echo "   perf: æ€§èƒ½"
fi

echo "ğŸ“ æäº¤ä¿¡æ¯éªŒè¯å®Œæˆ"

